!function(t){t("html").append(`
    <div class="modal fade" id="modal-selectMaster">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="overlay">
                    <i class="fas fa-2x fa-sync fa-spin"></i>
                </div>
                <div class="modal-header">
                    <h4 class="modal-title">Select Master</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div class="ribbon-wrapper">
                    <div class="ribbon bg-info">
                        BETA
                    </div>
                </div>

                <div class="modal-body">
                    <div class="card card-primary card-outline">
                        <div class="card-body">
                            <ul class="nav nav-tabs" id="custom-content-below-tab" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" id="update-content-tab" data-toggle="pill" href="#update-content" role="tab" aria-controls="update-content" aria-selected="true">Actualizar</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="add-content-tab" data-toggle="pill" href="#add-content" role="tab" aria-controls="add-content" aria-selected="false">Agregar</a>
                                </li>
                            </ul>
                            <div class="tab-content mt-3" id="custom-content-below-tabContent">
                                <div class="tab-pane fade show active" id="update-content" role="tabpanel" aria-labelledby="update-content-tab">
                                    <table class="table tableD">
                                        <thead>
                                            <tr>
                                                <th>Opciones</th>
                                                <th>Editar</th>
                                            </tr>
                                        </thead>
                                    </table>
                                </div>
                                <div class="tab-pane fade" id="add-content" role="tabpanel" aria-labelledby="add-content-tab">
                                    <form>
                                        <h1>Pendiente :/</h1>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    `);let e=`${location.origin}/${location.pathname.split("/")[1]}`,a=function(t,e=null){var a;let o=(a=t)instanceof Element||a instanceof HTMLDocument?t:document.createElement(t);if(null!==e)for(data in e)["text"].includes(data)?o.textContent=e[data]:o.setAttribute(data,e[data]);return o},o=function(){t("#modal-selectMaster table").DataTable().ajax.reload(null,!1)};jQuery.fn.smTagName=function(t){if(t)return this.prop("tagName")},jQuery.fn.smLoadContent=function(t,e,o,l){if(t){if(checkSelect2=this.hasClass("select2"))for(ident in e)this.find(`[value="${e[ident][o]}"]`).length?this.find(`[value="${e[ident][o]}"]`).text(e[ident][l]):this.append(new Option(e[ident][l],e[ident][o])).trigger("change");else for(ident in e)this.find(`[value="${e[ident][o]}"]`).length?this.find(`[value="${e[ident][o]}"]`).text(e[ident][l]):this.append(a("option",{value:e[ident][o],text:e[ident][l]}))}},jQuery.fn.smModeEdit=function(e,a,l,n){if(e){let s=t(`[data-selectMaster="${e}"]`),i=this.val(),d=automaticForm("updateValueSql",[i,l,a,n]);d.error?alerts({text:`selectMaster->sql: ${d.error}`,duration:1e4}):(l=s.get(0).selectMaster,checkSelect2=s.hasClass("select2"),o(),s.find(`[value="${a}"]`).text(i),checkSelect2)}},jQuery.fn.smChangeMode=function(e,a){e&&(t(`[data-show="${a}"]`).toggleClass("d-none"),t(`[data-edit="${a}"]`).toggleClass("d-none"))},jQuery.fn.smLoadPopper=function(t="selectMaster",e="selectMaster"){this.attr("data-toggle","popover").popover({html:!0,container:"body",trigger:"focus click",title:t,content:e})};let l=function(e,a){t.data(e.get(0))&&(t.removeData(e.get(0)),e.off(a),e.unbind(`.${a}`))};t("#modal-selectMaster form").on("submit",function(a){a.preventDefault();let l=t(this).get(0).selectMaster,n=t(`[data-selectMaster="${l.ident}"]`);t.ajax(`${e}/assets/js/plugins/selectMaster.php?accion=submit&table=${l.table}`,{type:"POST",dataType:"JSON",data:new FormData(this),contentType:!1,cache:!1,processData:!1,success:function(t){t.error?alerts({text:`selectMaster->sql: ${t.error}`,duration:1e4}):(o(),data=automaticForm("getDataSql",[l.table,"1 = 1",`${l.option_id}, ${l.option_value}`]),jQuery(n).smLoadContent(l.ident,data,l.option_id,l.option_value))}})}),t.fn.selectMaster=function(a,o=!1){let n=t(this),s=t("#modal-selectMaster form"),i=Date.now(),d=jQuery(n).smTagName(i);if(n.html(n.html()),l(n,"selectMaster"),!0!==o||!a.table||!a.option_value||($checkTableExists=automaticForm("checkTableExists",[a.table]))||t.ajax(`${e}/assets/js/plugins/selectMaster.php?token=${i}&accion=create&table=${a.table}&option_value=${a.option_value}`),1==this.length&&"SELECT"==d&&a.table&&a.option_value){let r=t.extend({table:void 0,option_id:"@primary",option_value:void 0,popover:{title:void 0,content:void 0},select2:!1,ident:i},a);r.popover.title||(r.popover.title="selectMaster"),r.popover.content||(r.popover.content="Registros en total: @count"),n.get(0).selectMaster=r,s.get(0).selectMaster=r,n.attr("data-selectMaster",i);let c=automaticForm("getDataSql",[r.table,"1 = 1",`${r.option_id}, ${r.option_value}`]);if(c.error)alerts({title:`selectMaster->Sql: ${c.error}`,icon:"Error",duration:"10000"});else{"@primary"==r.option_id&&(r.option_id=automaticForm("getNamePrimary",[r.table])),jQuery(n).smLoadContent(i,c,r.option_id,r.option_value);let p=r.popover.title.replaceAll("@count",c.length),v=r.popover.content.replaceAll("@count",c.length);$poper=r.select2&&n.hasClass("select2")?t($select2=n.get(0).nextElementSibling):n,jQuery($poper).smLoadPopper(function(){return`
                    <div class="d-flex justify-content-between">
                        <div>${p}</div>
                        <div>
                            <a class="mt-1 p-1 rounded btn-info ${i}">
                                <i class="fa fa-cog"></i>
                            </a>
                        </div>
                    </div>
                    `},v),t(document).on("click",`.${i}`,function(){t(".popover").popover("hide"),($modal=t("#modal-selectMaster")).css("overflow-y","auto"),$modal.find(".overlay").removeClass("d-none"),s.html(""),s.append(`
                        <div class="mb-3">
                            <label>Agregar Nueva Opci\xf3n</label>
                            <input type="text" name="data[${r.option_value}]" class="form-control">
                        </div>
                        <div class="mb-3">
                            <button type="submit" class="btn btn-success"><i class="fa fa-plus"></i></button>
                        </div>
                    `),$modal.modal("show"),($table=t("#modal-selectMaster table")).DataTable().destroy(),$table.DataTable(t.extend(datatableParams,{processing:!0,severSide:!0,order:[[0,"desc"]],ajax:`${e}/assets/js/plugins/selectMaster.php?token=${i}&accion=ssp&table=${r.table}&option_value=${r.option_value}`,deferRender:!0,initComplete:""})),setTimeout(()=>{$modal.find(".overlay").addClass("d-none")},1e3)})}return n}alerts({title:"selectMaster: "+(1!=this.length?"Objeto no encontrado.":"SELECT"!=d?`Objeto no valido: ${d}.`:a.table?a.option_value?"Error is undefined :/":`Campo a mostrar es obligatorio: option_value->${a.option_value}.`:"Nombre de la tabla es obligatorio."),icon:"Error",duration:"10000"})}}(jQuery);
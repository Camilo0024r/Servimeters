$(document).ready(async function () { config = await loadConfig(); try { server = new WebSocket(`ws://localhost:${config.WEBSOCKET}/`) } catch (t) { } server.onerror = function (t) { alerts({ icon: "error", title: "WebSocket inactivo.", position: "bottom-start" }), resp = $.ajax(`${location.origin}/${location.pathname.split("/")[1]}/bin/start.php`, { async: !1 }) }, server.onopen = function (t) { session = automaticForm("readSession"), localStorage.setItem("rol", session.rol ?? "NA"), localStorage.setItem("gestiona", session.gestiona ?? "NA"), localStorage.setItem("usuario", session.usuario ?? "NA"), localStorage.setItem("email", session.email ?? "NA") }, server.onmessage = function (t) { (resp = JSON.parse(t.data)).type ? "alerts" != resp.type || (arrayAlert = resp.data.arrayAlert ? resp.data.arrayAlert : {}, typeAlert = resp.data.typeAlert ? resp.data.typeAlert : "Sweetalert2", rol = String(automaticForm("getSession", ["rol"])), usuario = String(automaticForm("getSession", ["usuario"])), resp.rol == rol ? alerts(arrayAlert, typeAlert) : resp.usuario == usuario ? alerts(arrayAlert, typeAlert) : resp.rol || resp.usuario || alerts(arrayAlert, typeAlert)) : console.log(resp) }, sendWS = t => { 1 == server.readyState ? server.send(JSON.stringify(t)) : alerts({ icon: "error", title: "WebSocket inactivo.", position: "bottom-start" }) } });